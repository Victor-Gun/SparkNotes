# Hive笔记（五）
__整理：leotse__

### HiveQL：数据操作
1.Hive没有行级的数据插入，数据更新和删除操作，那么往表中装载数据的唯一途径就是使用一种“大量的”数据装载操作；或者通过其他方式仅仅将文件写入到正确的目录下；

2.**关键字OVERWRITE**：首先看下面的命令：  
`LOAD DATA LOCAL INPATH '/home/test/test.log'`  
`OVERWRITE INTO TABLE t_test`  
`PARTITION (dt='2015-09-06')`
如果分区目录不存在，那么这个命令将会创建该目录，然后再将数据拷贝到该目录下；如果是非分区表，那么语句中应该省略PARTITION子句。  
通常情况下，指定的路径应该是一个目录，而不是单个独立的文件。Hive会将所有的文件拷贝到这个目录中。  
如果使用了LOCAL，那么这个路径应该为本地文件系统路径，数据将会被拷贝到目标位置，如果省略LOCAL，那么这个路径应该是分布式文件系统中的路径，这种情况下，数据是从这个路径转移到目标位置中。  
用户不可以使用LOAD DATA将数据从一个集群的HDFS中转移到另一个集群的HDFS中。  
指定全路径会有更好的鲁棒性，但也同样支持相对路径。  
如果用户指定了OVERWRITE关键字，那么目标文件夹中之间存在的数据将会被先删除掉；如果没有这个关键字，仅仅会把新增的文件增加到目标文件夹而不会删除之前的数据，然而如果目标文件夹中已经存在和装载的文件同名的文件，那么旧的同名文件将会被覆盖重写。（**事实上，如果没有使用OVERWRITE，而且目标文件夹中已经存在同名的文件时，会保留之前的文件并会重命名新文件为”之前的文件名_序列号“**）。  
如果目标表是分区表，那么需要使用PARTITION子句，而且用户还必须为每个分区的键指定一个值；  
对于INPATH子句中使用的文件路径还有一个限制，那就是这个路径下不可以包含任何文件夹。  
Hive并不会验证用户装载的数据和表的模式是否匹配，然而，Hive会验证文件格式是否合表结构定义的一致。

3.导出数据：一般有两种方式，第一种是直接从HDFS中直接copy就行：  
`hadoop fs -cp source_path target_path`  
用户还可以使用INSERT...DIRECTORY...，如下：  
`INSERT OVERWRITE LOCAL DIRECTORY '/tmp/local.txt'`  
`SELECT name, age FROM student`  
`WHERE "dt=2015-09-06"`
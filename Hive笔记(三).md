# Hive笔记（三）
__整理：leotse__

### HiveQL:数据定义
1.Hive不支持行级插入操作、更新操作和删除操作，同时它也不支持事务。

2.Hive中数据库的概念本质上仅仅是表的一个目录或者命名空间。如果用户没有显式指定数据库，就会默认使用默认库default。

3.在Hive中，所有命令中的table关键字都可以使用schema来替代。

4.Hive会为每个数据库创建一个目录，这个数据库中表会以这个数据库目录的子目录形式存储。但是有一个例外，default数据的表并不是这样，因为它压根就没有自己的目录。  
我们通过该命令来修改默认的位置：  
`hive> create database test_db location '/tmp/hive/leotse/test_db';`  
这个目录删除后，下次使用时会重建，但是里面的数据会丢失。

5.默认情况下，Hive是不允许用户删除一个包含有表的数据库的，用户要么先删除数据库中的表，然后再删除数据库；要么在删除命令的最后加上关键字CASCADE，这样就可以使Hive自行先删除数据库中的表。  
如果一个库被删除了，那么其对应的目录也会同时被删除。

6.Hive重复建表的问题：  
如果建表时加上IF NOT EXIST，那么如果该表已经存在，系统就会自动忽略掉后面的执行语句；   
但是，如果用户指定的表的模式和已经存在的表的模式不同的话，Hive不会做出提示；  
如果用户的意图是让这个表具有重新指定的新的模式，那么就需要先删掉原来的表，然后重新建表。但是此时，原表中的数据会丢失。我们可以考虑使用一个或多个ALTER TABLE来修改现有的表结构。

7.用户还可以copy一张已经存在的表的模式，而无需copy数据：  
`hive> CREATE TABLE IF NOT EXISTS test_db.t_table2 LIKE test_db.t_table;`  

8.我们可以使用`DESCRIBE EXTENDED table_name`来查看表的详细信息。

9.**内部表**（又名管理表）：这种表，Hive或多或少会控制着数据的生命周期，Hive会默认将这些表的数据存储在由配置项hive.metastore.warehouse.dir所定义的目录的子目录下。  
当我们删除一个内部表时，Hive也会删除这个表中数据。

10.**外部表**：我们使用关键字EXTENAL告诉Hive表是外部表，而可以使用LOCATION来告诉Hive数据位于哪个路径下，Hive并非被认为对外部表拥有表里的数据，因此，删除表不会删除数据，不过描述表的元数据会被删除。如果数据会被多个工具共享，那么可以创建一个外部表，来明确对数据的所有权。

11.如果语句中省略掉EXTERNAL关键字而且源表是外部表的话，那么生成的新表也是外部表；如果语句中哦省略掉EXTERNAL关键字而且源表是内部表的话，那么生成的新表也将是内部表；但是，如果语句中包含有EXTERNAL关键字而源表是内部表，那么生成的新表将是外部表。